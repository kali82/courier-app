<div *ngIf="isAuthenticated">
  <h1 class="mat-title">lista przesyłek</h1>
  <mat-form-field class="filter">
    <input
      matInput
      (keyup)="applyFilter($event.target.value)"
      placeholder="wyszukaj przesyłkę"
    />
  </mat-form-field>
  <div class="list-container">
    <mat-table #table [dataSource]="dataSource" matSort>
      <ng-container matColumnDef="select" class="mat-col-checkbox">
        <mat-header-cell *matHeaderCellDef>
          <mat-checkbox
            (change)="$event ? masterToggle() : null"
            [checked]="selection.hasValue() && isAllSelected()"
            [indeterminate]="selection.hasValue() && !isAllSelected()"
          ></mat-checkbox>
        </mat-header-cell>
        <mat-cell *matCellDef="let element" (click)="$event.stopPropagation()">
          <mat-checkbox
            (change)="$event ? selection.toggle(element) : null"
            [checked]="selection.isSelected(element)"
          ></mat-checkbox>
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="consignmentId">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          id przesyłki
        </mat-header-cell>
        <mat-cell *matCellDef="let element">{{
          element.consignmentId
        }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="login">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          użytkownik
        </mat-header-cell>
        <mat-cell *matCellDef="let element">{{ element.login }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="shipperName">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          nadawca
        </mat-header-cell>
        <mat-cell *matCellDef="let element">{{ element.shipperName }}</mat-cell>
      </ng-container>

      <ng-container matColumnDef="receiverName">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          odbiorca
        </mat-header-cell>
        <mat-cell *matCellDef="let element">
          {{ element.receiverName }}
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="status">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          status
        </mat-header-cell>
        <mat-cell *matCellDef="let element">
          {{ element.trackAndTraceInfo[0].status }}
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="shipmentDateTime">
        <mat-header-cell *matHeaderCellDef mat-sort-header>
          data nadania
        </mat-header-cell>
        <mat-cell *matCellDef="let element">
          {{ element.shipmentDateTime }}
        </mat-cell>
      </ng-container>

      <ng-container matColumnDef="action">
        <mat-header-cell *matHeaderCellDef mat-sort-header> </mat-header-cell>
        <mat-cell *matCellDef="let element">
          <button
            class="edit-button"
            mat-raised-button
            color="primary"
            matTooltip="utwórz podobną"
            matTooltipPosition="above"
            (click)="$event.stopPropagation()"
          >
            <mat-icon>create</mat-icon>
          </button>
          <button
            class="edit-button"
            mat-raised-button
            color="primary"
            matTooltip="wydrukuj etykietę"
            matTooltipPosition="above"
            (click)="
              onLabelPrint(element.consignmentId); $event.stopPropagation()
            "
          >
            <mat-icon>print</mat-icon>
          </button>
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row
        *matRowDef="let row; columns: displayedColumns"
        matRipple
        class="element-row"
        [cdkDetailRow]="row"
        [cdkDetailRowTpl]="tpl"
      >
      </mat-row>
    </mat-table>

    <mat-progress-spinner
      color="primary"
      mode="indeterminate"
      *ngIf="isLoading"
    >
    </mat-progress-spinner>

    <mat-toolbar class="toolbar">
      <mat-toolbar-row>
        <button
          *ngIf="selection.hasValue()"
          mat-button
          class="delete-button"
          (click)="deleteSelected()"
          matTooltip="usuń wybrane"
          matTooltipPosition="above"
        >
          <mat-icon>delete</mat-icon>
        </button>
        <mat-paginator
          pageSize="10"
          [pageSizeOptions]="[5, 10, 100]"
          (page)="pageEvent = handlePage($event)"
        ></mat-paginator>
      </mat-toolbar-row>
    </mat-toolbar>
  </div>

  <button mat-raised-button color="accent" routerLink="create">
    <i class="material-icons">
      add_circle
    </i>
    utwórz nową przesyłkę
  </button>

  <ng-template #tpl let-element>
    <div class="mat-row detail-row">
      <mat-grid-list cols="{{ detailColumns }}">
        <mat-grid-tile>
          <p>id {{ element.consignmentId }}</p>
        </mat-grid-tile>
        <mat-grid-tile>
          <p>nadawca {{ element.shipperName }}</p>
        </mat-grid-tile>
        <mat-grid-tile>
          <p>odbiorca {{ element.receiverName }}</p>
        </mat-grid-tile>
        <mat-grid-tile>
          <ng-container *ngFor="let status of element.trackAndTraceInfo">
            <div>
              <p>{{ status.description }}</p>
              <p>{{ status.timestamp }}</p>
            </div>
          </ng-container>
        </mat-grid-tile>
      </mat-grid-list>
      <button
        mat-button
        matTooltip="szczegóły przesyłki"
        (click)="showDetails(element.consignmentId)"
      >
        szczegóły
      </button>
    </div>
  </ng-template>
</div>
